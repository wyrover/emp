"use strict";Vue.http.headers.common["X-CSRF-TOKEN"]=document.querySelector("#token").getAttribute("value");var baseURL="http://"+window.location.host,id=window.location.href.split("#")[1];"undefined"==typeof id&&(id=1);var api="http://"+window.location.host+"/api/v1/locale/",vm=new Vue({el:"#app",data:{keyword:"",sortKey:"",reverse:!1,records_show:10,pagersCount:5,perpage:15,disabled:!0,current_office:id,currentChart:"positions",newLocale:"",offices:[],editable:!0,remove_id:"",edit_id:"",current_employee:1,columns:[{header:"姓名","class":""},{header:"岗位","class":""},{header:"单位","class":""}],ids:["pinyin","position_id","company_id"]},ready:function(){this.getData()},methods:{buttonState:function(){this.disabled=$("#datatable>tbody input:checkbox:checked").length>0?!1:!0},getData:function(t){addLoading(),this.$http.get(baseURL+"/api/v1/locale?locale="+this.current_office+"&page="+t+"&perpage="+this.perpage,function(t){this.$set("user_level",t.user_level),this.$set("offices",t.offices),this.$set("positions",t.positions),this.$set("companies",t.companies),this.$set("data",t.data),this.$set("total",t.total),this.$set("from",t.from),this.$set("to",t.to),this.$set("perPage",t.per_page),this.$set("currentPage",t.current_page),this.$set("lastPage",t.last_page)}).success(function(t){removeLoading(),this.setChartData(t[this.currentChart])}).error(function(t){$("#show-error").show()})},changeChart:function(t){var e=t;this.setChartData(this[e])},setChartData:function(t){var e=[];for(var a in t)e.push({value:t[a],label:a,color:randomColor({hue:"green",luminosity:"dark"}),highlight:"#5AD3D1"});this.chartData=e,this.drawChart()},resetCanvas:function(){$("#myChart").remove(),$("#chartBox").append('<canvas id="myChart"><canvas>')},drawChart:function(){this.resetCanvas();var t=$("#myChart").get(0).getContext("2d"),e={segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,responsive:!0,animationEasing:"easeOutElastic",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'},a=new Chart(t).Doughnut(this.chartData,e),s=this.chartData;legend(document.getElementById("legend"),s,a,"<%=label%>: <%=value%>人")},changeLocale:function(t){this.current_office=t.target.id,this.getData()},changePerPage:function(t){this.perpage=t,this.getData()},sortBy:function(t){var e=$(t.target).closest("th").attr("id");this.sortKey=e,this.reverse=this.sortKey==e?!this.reverse:!1},goSearch:function(){this.perpage="all",this.getData("all")},clearInput:function(){this.$$.input.value=""},editLocale:function(t){this.removeLocale(t),this.editable=!1,$("#updateEle").fadeIn(),$("#updateInput").val(t.name),this.edit_id=t.id},updateLocale:function(){var t=$("#updateInput").val(),e={name:t};""!==t&&this.$http.put(api+this.edit_id,e,function(){$("#updateEle").fadeOut(),this.getData()}).error(function(){StarPop.show("操作不成功！请检查网络连接，或重新登录")}),this.editable=!0},addNew:function(){$("#addNewEle").fadeIn()},removeLocale:function(t){this.offices.$remove(t)},saveNew:function(){var t={name:$("#addNew").val()};this.validate()||this.$http.post(api,t,function(){$("#addNewEle").fadeOut(),$("#addNew").val(""),this.getData()}).error(function(){StarPop.show("操作不成功！请检查网络连接，或重新登录")})},showCard:function(t,e){var a=$(e.target);a.attr("data-content",'<div class="list-unstyled"><p>赴哈时间:'+t.reached_at+"</p><p>护照号码:"+t.passport+"</p><p>护照期限:"+t.passport_deadline+"</p><p>签证期限:"+t.visa_deadline+"</p></div>"),a.popover("show"),a.bind({mouseout:function(){a.popover("hide")}})},setRemoveId:function(t){var e=$(t.target).closest("a").attr("data-id");$("#btn_delete").attr("data-id",e)},removeData:function(t){addLoading();var e=$(t.target).closest("a").attr("data-id");this.$http["delete"](api+e).success(function(){this.getData(),console.log(this.remove_id),$("#modal").modal("hide")})},validate:function(){var t=!1;return""==$("#addNew").val()&&(t=!0),t}},computed:{pagers:{get:function(){var t=[],e=this.$data.currentPage,a=this.$data.lastPage,s=e+this.pagersCount,i=Math.round((parseInt(this.pagersCount)-1)/2);if(1>e-i)if(e+i>=a)for(var o=1;a>=o;o++)t.push(o);else for(var o=1;s>o;o++)t.push(o);else if(e+i>a)if(a-this.pagersCount>0)for(var o=a-this.pagersCount;a+1>o;o++)t.push(o);else for(var o=1;e>=o;o++)t.push(o);else for(var o=e;s>o;o++){var r=o-i;t.push(r),r++}return t}}}});