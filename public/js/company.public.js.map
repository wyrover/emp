{"version":3,"sources":["company.public.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"company.public.js","sourcesContent":["\"use strict\";\nVue.http.headers.common[\"X-CSRF-TOKEN\"] = document.querySelector(\"#token\").getAttribute(\"value\");\nvar baseURL =  'http://'+window.location.host ;\nvar id = window.location.href.split('#')[1];\nif( typeof id === 'undefined'){\n    id = 1;\n}\nvar api = 'http://'+window.location.host + '/api/v1/company/';\nvar vm = new Vue({\n    el: \"#app\",\n    data: {\n        keyword: \"\",\n        sortKey:\"\",\n        reverse:false,\n        records_show:10,\n        pagersCount:5,//显示的pager数量\n        perpage:15,\n        disabled:true,\n        current_company:id,\n        newLocale:'',\n        companies:[],\n        editable:true,\n        remove_id:'',\n        edit_id:'',\n        current_employee:1,\n        columns:[\n            {\n                'header':'姓名',\n                'class':''\n            },\n            {\n                'header':'岗位',\n                'class':''\n            },\n            {\n                'header':'所在现场',\n                'class':''\n            }\n\n        ],\n        ids:[\n            \"pinyin\",\"position_id\",\"office_id\"\n        ]\n    },\n\n    ready:function(){\n        this.getData();\n        //this.makePagers();\n    },\n\n    methods:{\n\n        buttonState:function(){\n\n            if($(\"#datatable>tbody input:checkbox:checked\").length>0)\n            {\n                this.disabled = false;\n            }else\n                this.disabled = true;\n        },\n        //从API获取相应数据\n        getData: function(page){\n            addLoading();\n            this.$http.get(baseURL+\"/api/v1/company?company=\" + this.current_company + \"&page=\" + page +\"&perpage=\"+this.perpage,function(data){\n                this.$set(\"user_level\",data[\"user_level\"]);\n                this.$set(\"companies\",data[\"companies\"]);\n                this.$set(\"positions\",data[\"positions\"]);\n                this.$set(\"offices\",data[\"offices\"]);\n                this.$set(\"data\",data[\"data\"]);\n                this.$set(\"total\",data[\"total\"]);\n                this.$set(\"from\",data[\"from\"]);\n                this.$set(\"to\",data[\"to\"]);\n                this.$set(\"perPage\",data[\"per_page\"]);\n                this.$set(\"currentPage\",data[\"current_page\"]);\n                this.$set(\"lastPage\",data[\"last_page\"]);\n            }).success(function(data){\n                removeLoading();\n            }).error(function (status) {\n                $(\"#show-error\").show();\n            });\n        },\n\n        changeCompany:function(e){\n            this.current_company = e.target.id;\n            this.getData();\n        },\n\n        changePerPage:function(param){\n            this.perpage =  param;\n            this.getData();\n        },\n\n        sortBy:function(e){\n            var onKey = $(e.target).closest(\"th\").attr('id');\n            this.sortKey = onKey;\n            this.reverse = (this.sortKey==onKey) ? !this.reverse : false; //如果初始的sortKey==onKey,反转,否则返回false不响应\n        },\n\n        goSearch:function(){\n            this.perpage = 'all';\n            this.getData('all');\n        },\n        clearInput:function(){\n            this.$$.input.value = '';\n        },\n        editPosition:function(position){\n           this.removePosition(position);\n            this.editable = false;\n            $('#updateEle').fadeIn();\n            $('#updateInput').val(position.name);\n            this.edit_id = position.id;\n        },\n        updatePosition:function(){\n            var input = $('#updateInput').val();\n            var data = {\n                name: input\n            };\n\n            if (input !==''){\n                this.$http.put(api+this.edit_id,data,function(){\n                    $('#updateEle').fadeOut();\n                    this.getData();\n                }).error(function(){\n                    StarPop.show('操作不成功！请检查网络连接，或重新登录')\n                });\n            };\n            this.editable = true;\n        },\n        addNew:function(){\n            $('#addNewEle').fadeIn();\n        },\n        removePosition:function(position){\n            this.positions.$remove(position);\n        },\n        saveNew:function(){\n            var input = {\n                name:$('#addNew').val()\n            };\n\n            if (! this.validate()){\n                this.$http.post(api,input,function(){\n                    $('#addNewEle').fadeOut();\n                    $('#addNew').val('');\n                    this.getData();\n                }).error(function(){\n                    StarPop.show('操作不成功！请检查网络连接，或重新登录')\n                });\n            }\n        },\n       showCard:function(item,e){\n            var popover = $(e.target);\n           popover.attr(\"data-content\",\n               '<div class=\"list-unstyled\">' +\n               '<p>赴哈时间:'+item.reached_at+'</p>' +\n               '<p>护照号码:'+item.passport+'</p>' +\n               '<p>护照期限:'+item.passport_deadline+'</p>' +\n               '<p>签证期限:'+item.visa_deadline+'</p>' +\n               '</div>');\n            popover.popover('show');\n            popover.bind({\n                mouseout:function(){\n                    popover.popover('hide');\n                }\n            });\n        },\n        setRemoveId:function(e){\n            var remove_id = $(e.target).closest(\"a\").attr('data-id');\n            $('#btn_delete').attr('data-id',remove_id); //把modal中的删除按钮赋值\n        },\n        removeData:function(e){\n            addLoading();\n            var remove_id = $(e.target).closest(\"a\").attr('data-id');\n            this.$http.delete(api+remove_id )\n                .success(function(){\n                    this.getData();\n                    console.log(this.remove_id);\n                    $(\"#modal\").modal(\"hide\");\n                });\n        },\n        validate:function(){\n            var has_err = false;\n                if($('#addNew').val() == ''){\n                    has_err = true;\n                }\n            return has_err;\n        },\n\n    },\n\n    computed:{\n        pagers:{\n            get:function(){\n                var pagers = [];\n                var current = this.$data[\"currentPage\"]; //从API中获取当前页码\n                var max = this.$data[\"lastPage\"];\n                var limited = current + this.pagersCount;\n                var sidebar = Math.round((parseInt(this.pagersCount) -1) /2);  //为把当前页面放到页码指示器的中间，获取两侧数量\n                if(current - sidebar <1){\n                    if( current + sidebar >= max){\n                        for(var i = 1; i <= max ; i++){\n                            pagers.push(i);\n                        };\n                    }\n                    else{\n                        for(var i = 1; i < limited ; i++){\n                            pagers.push(i);\n                        };\n                    }\n                }\n\n\n                else if ( current + sidebar > max ){\n                    if(max - this.pagersCount > 0){\n                        for(var i = max - this.pagersCount; i < max+1; i++){\n                            pagers.push(i);\n                        }\n                    }\n                    else{\n                        for(var i = 1; i <= current; i++){\n                            pagers.push(i);\n                        }\n                    }\n                }\n\n                else{\n                    for(var i = current; i < limited ; i++){\n                        var j = i- sidebar;\n                        pagers.push(j);\n                        j++;\n                    };\n                }\n\n\n                return pagers;\n            }\n        }\n    }\n\n\n});\n\n"],"sourceRoot":"/source/"}